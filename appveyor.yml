version: 2.4.{build}
image: 
- Visual Studio 2019
platform: x64
configuration: Release

install:
  - appveyor DownloadFile https://github.com/billziss-gh/winfsp/releases/download/v1.6/winfsp-1.6.20027.msi
  - start /wait msiexec /i winfsp-1.6.20027.msi /qn ADDLOCAL=ALL
  # - ps: Write-host "Rebooting..." 
  # - ps: Restart-Computer -Force 
  # - ps: Start-Sleep -s 1
  - echo Setup wsl...
  - ps: tools\setup_wsl.ps1
  - echo Installing python dependencies...
  - C:\Python38\python -m pip install paramiko pyyaml psutil
  - echo Setup ssh...
  - C:\Python38\python tools\golddrive-v1.0\app\setupssh.py support@localhost:22

build_script:
  - msbuild src\golddrive.sln /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll" /verbosity:minimal
  - start /wait msiexec /i src\build\Release\golddrive-2.4.0.msi /qn
  - dir "C:\Program Files"
  - dir "C:\Program Files\Golddrive"
  - dir "C:\Program Files (x86)\WinFsp"
  - net use
  - net use X: \\golddrive\support@localhost
  - net use X: /d

test:
  # only categories to test
  categories:
    only:
      - Appveyor1